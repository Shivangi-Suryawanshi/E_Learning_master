"use strict";var _createClass=function(){function n(t,a){for(var e=0;e<a.length;e++){var n=a[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,a,e){return a&&n(t.prototype,a),e&&n(t,e),t}}();function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}var Pagination=function(){function a(t){_classCallCheck(this,a),this.option=t,this.limit=t.limit||10,this.offset=t.offset||0,this.page=t.page||1,this.limit=this.per_page=t.per_page||10,this.total_items=t.total_items,this.total_pages=Math.ceil(this.total_items/this.per_page)}return _createClass(a,[{key:"hasPages",value:function(){return this.total_items>this.limit}},{key:"onFirstPage",value:function(){return 1==this.page}},{key:"currentPage",value:function(){return this.page}},{key:"hasMorePages",value:function(){return this.page<this.total_pages}},{key:"totalPages",value:function(){return this.total_pages}},{key:"countOfShownItems",value:function(){return(this.page-1)*this.limit}},{key:"setPage",value:function(t,a){this.page=t,setOffset(t),this.total_items=a,this.total_pages=Math.ceil(this.total_items/this.per_page)}},{key:"pageHasChanged",value:function(t){return this.page!==t}},{key:"hasPage",value:function(t){return t<=this.total_pages}},{key:"setOffset",value:function(t){this.option.get("lazy_load")?(this.offset=0,this.limit=t*this.per_page):(this.offset=(t-1)*this.per_page,this.limit=this.per_page)}}]),a}(),windowWidth=$(window).width(),TaskManager=function(){function a(t){_classCallCheck(this,a);this.setOptions(t,{container:null,data:null,searchables:null,perPage:10,pageIndex:0}),this.container=this.options.container,this.setLayout(this.container),this.originalData=_.clone(this.options.data),this.data=_.clone(this.options.data),this.paginatedData=this.paginateData(this.data),this.selectedTasks=[]}return _createClass(a,[{key:"setLayout",value:function(t){this.tasksContainer=t.append('\n\t\t\t<div class="task-manager-content"></div>\n\t\t').children().last(),this.paginationContainer=t.append('\n\t\t\t<div class="task-manager-pagination"></div>\n\t\t').children().last()}},{key:"setOptions",value:function(t,a){for(var e in a)void 0===t[e]&&(t[e]=a[e]);this.options=t}},{key:"build",value:function(){this.data=_.orderBy(this.data,["deadline"],["desc"]),this.tasksContainer.html(this.toolbarView()),this.tasksContainer.append(this.view()),this.paginationContainer.html(this.pagination()),this.setEventListeners(),this.setUpPaginationEventListeners(),this.container.trigger("update.task-manager")}},{key:"pagination",value:function(){var t=new Pagination({per_page:this.options.perPage,offset:this.options.pageIndex*this.options.perPage,page:this.options.pageIndex+1,limit:this.options.perPage,total_items:this.data.length});return this.paginationView(t)}},{key:"view",value:function(){this.paginatedData=this.paginateData(this.data);var t,a=_.groupBy(this.paginatedData,function(t){return t.deadlineDate}),e=[];for(var n in a){var i=a[n];e.push(this.dayView(n,i))}var s=new Pagination({per_page:this.options.perPage,offset:this.options.pageIndex*this.options.perPage,page:this.options.pageIndex+1,limit:this.options.perPage,total_items:a.length});return t=this.paginationView(s),e.join("\n")+"\n"+t}},{key:"dayView",value:function(t,a){var e=[];e.push('\n\n\t\t<div class="task-group active" id="task-group-today">\n\n\t\t\t<div class="task-group-label">\n\t\t\t\t<button class="btn" data-toggle="class">\n\t\t\t\t\t<i class="fas fa-caret-down"></i>\n\t\t\t\t\t<h6>'+moment(t).calendar().split(" ")[0]+" </h6><small>("+a.length+')</small>\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<div class="tasks show">\n\t\t\t\t\n\t\t\t\t<table class="table table-responsive">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t<th></th>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t');for(var n=0;n<a.length;n++){var i=a[n];e.push(this.taskView(i))}return e.push("\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>"),e.join("\n")}},{key:"taskView",value:function(t){for(var a=[],e=0;e<t.members.length;e++){var n=t.members[e];a.push('\n\t\t\t\t<a href="#" class="member-link" data-id="'+n.id+'"><img src="'+ROOT_URL+"/"+n.image+'" data-toggle="tooltip" title="'+n.name+'" alt="'+n.name+' image"></a>\n\t\t\t')}var i="";i=0<t.status?this.translateStatus(t.status)+" At "+moment(t.updated_at).calendar():this.translateStatus(t.status);var s="";s=t.status<3?'<button data-id="'+t.id+'" class="btn btn-sm btn-primary-light btn-update-status">Mark As '+this.translateStatus(parseInt(t.status)+1)+"</span>":"";var o=moment(t.deadline).fromNow();return moment(t.deadline).diff(moment())<0&&(o="Passed"),'\n\t\t<tr>\n\t\t\t<td style="width: 20px;">\n\t\t\t\t<div class="custom-control custom-checkbox custom-checkbox-2">\n\t\t\t\t\t<input type="checkbox" class="custom-control-input" data-id="'+t.id+'" id="table-checkbox-'+t.id+'">\n\t\t\t\t\t<label class="custom-control-label" for="table-checkbox-'+t.id+'"></label>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t\t<td class="text-blue">\n\t\t\t\t'+t.id+'\n\t\t\t</td>\n\t\t\t<td class="text-blue">\n\t\t\t\t'+t.name+'\n\t\t\t</td>\n\t\t\t<td class="not-selectable">\n\t\t\t\t<div class="img-stack">\n\t\t\t\t\t'+a.join("\n")+'\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t\t<td>\n\t\t\t\t<span class="badge badge-'+this.statusColor(t.status)+'-light">'+i+"</span>\n\t\t\t</td>\n\t\t\t<td>\n\t\t\t\t"+s+'\n\t\t\t</td>\n\t\t\t<td>\n\t\t\t\t<span class="text-blue">\n\t\t\t\t\t<i class="far fa-clock"></i>\n\t\t\t\t\t'+moment(t.deadline).format("HH:mm:ss")+' <small class="text-muted">('+o+')</small>\n\t\t\t\t</span>\n\t\t\t</td>\n\t\t\t<td class="operations">\n\t\t\t\t<a href="#" class="btn-edit btn-icon btn btn-primary-light p-2" data-id="'+t.id+'">\n\t\t\t\t\t<svg fill="#5780f7" viewBox="0 0 1024 1024"><path d="M978.101 45.898c-28.77-28.768-67.018-44.611-107.701-44.611-40.685 0-78.933 15.843-107.701 44.611l-652.8 652.8c-2.645 2.645-4.678 5.837-5.957 9.354l-102.4 281.6c-3.4 9.347-1.077 19.818 5.957 26.85 4.885 4.888 11.43 7.499 18.104 7.499 2.933 0 5.891-0.502 8.744-1.541l281.6-102.4c3.515-1.28 6.709-3.312 9.354-5.958l652.8-652.8c28.768-28.768 44.613-67.018 44.613-107.702s-15.843-78.933-44.613-107.701zM293.114 873.883l-224.709 81.71 81.712-224.707 566.683-566.683 142.997 142.997-566.683 566.683zM941.899 225.098l-45.899 45.899-142.997-142.997 45.899-45.899c19.098-19.098 44.49-29.614 71.498-29.614s52.4 10.518 71.499 29.616c19.098 19.098 29.616 44.49 29.616 71.498s-10.52 52.4-29.616 71.498z"></path></svg>\n\t\t\t\t</a>\n\t\t\t\t<a href="#" class="btn-delete btn-icon btn btn-danger-light p-2" data-id="'+t.id+'">\n\t\t\t\t\t<svg fill="#ed3472" viewBox="0 0 1024 1024">\n\t\t\t\t\t\t<path d="M793.6 102.4h-179.2v-25.6c0-42.347-34.453-76.8-76.8-76.8h-102.4c-42.347 0-76.8 34.453-76.8 76.8v25.6h-179.2c-42.347 0-76.8 34.453-76.8 76.8v51.2c0 33.373 21.403 61.829 51.2 72.397v644.403c0 42.349 34.453 76.8 76.8 76.8h512c42.349 0 76.8-34.451 76.8-76.8v-644.403c29.797-10.568 51.2-39.024 51.2-72.397v-51.2c0-42.347-34.451-76.8-76.8-76.8zM409.6 76.8c0-14.115 11.485-25.6 25.6-25.6h102.4c14.115 0 25.6 11.485 25.6 25.6v25.6h-153.6v-25.6zM742.4 972.8h-512c-14.115 0-25.6-11.485-25.6-25.6v-640h563.2v640c0 14.115-11.485 25.6-25.6 25.6zM819.2 230.4c0 14.115-11.485 25.6-25.6 25.6h-614.4c-14.115 0-25.6-11.485-25.6-25.6v-51.2c0-14.115 11.485-25.6 25.6-25.6h614.4c14.115 0 25.6 11.485 25.6 25.6v51.2z"></path><path class="path2" d="M640 358.4c-14.139 0-25.6 11.462-25.6 25.6v512c0 14.139 11.461 25.6 25.6 25.6s25.6-11.461 25.6-25.6v-512c0-14.138-11.461-25.6-25.6-25.6z"></path><path class="path3" d="M486.4 358.4c-14.138 0-25.6 11.462-25.6 25.6v512c0 14.139 11.462 25.6 25.6 25.6s25.6-11.461 25.6-25.6v-512c0-14.138-11.462-25.6-25.6-25.6z"></path><path class="path4" d="M332.8 358.4c-14.138 0-25.6 11.462-25.6 25.6v512c0 14.139 11.462 25.6 25.6 25.6s25.6-11.461 25.6-25.6v-512c0-14.138-11.462-25.6-25.6-25.6z"></path>\n\t\t\t\t\t</svg>\n\t\t\t\t</a>\n\t\t\t</td>\n\t\t</tr>'}},{key:"toolbarView",value:function(){return'\n\t\t<div class="btn-toolbar task-manager-toolbar my-4" role="toolbar" aria-label="Toolbar with button groups">\n\t\t\t<div class="btn-group mr-2" role="group" aria-label="First group">\n\t\t\t\t<button type="button" class="btn-finish-all btn btn-sm btn-primary">Mark As Finished</button>\n\t\t\t</div>\n\t\t\t<div class="btn-group mr-2" role="group" aria-label="Second group">\n\t\t\t\t<button type="button" class="btn-delete-all btn btn-sm btn-danger">Delete</button>\n\t\t\t</div>\n\t\t</div>\n\t\t\t'}},{key:"paginationView",value:function(t){var a=[],e=7;if(!t.hasPages())return"";if(a.push('\n\t\t<nav aria-label="Page navigation example">\n\t\t\t<ul class="pagination pagination-inverse pagination-round pagination-hard-square">\n\t\t'),t.onFirstPage())a.push('\n\t\t\t\t\t\t<li class="page-item disabled">\n\t\t\t\t\t\t\t<span class="page-link" aria-label="Previous">\n\t\t\t\t\t\t\t\t<i class="fas fa-angle-left"></i>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t');else{var n=t.currentPage()-1;a.push('\n\t\t\t\t\t\t<li class="page-item">\n\t\t\t\t\t\t\t<a class="page-link" data-page="'+n+'" href="javascript:void(0)" rel="prev" aria-label="Previous">\n\t\t\t\t\t\t\t\t<i class="fas fa-angle-left"></i>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t')}if(windowWidth<500&&(e=5),t.totalPages()>e){a.push(this.createPaginationLink(t,1));var i=2,s=t.totalPages()-1;windowWidth<500?(t.currentPage()<=3?(i=2,s=3):i=s=t.currentPage(),t.totalPages()-t.currentPage()<3&&(i=t.totalPages()-2,s=t.totalPages()-1)):(s=t.currentPage()<5?(i=2,5):(i=t.currentPage()-1,t.currentPage()+1),t.totalPages()-t.currentPage()<5&&(i=t.totalPages()-4,s=t.totalPages()-1)),2<i&&a.push('<li class="page-item disabled" aria-current="page"><span class="page-link">...</span></li>');for(var o=i;o<=s;o++)a.push(this.createPaginationLink(t,o));2<t.totalPages()-s&&a.push('<li class="page-item disabled" aria-current="page"><span class="page-link">...</span></li>'),a.push(this.createPaginationLink(t,t.totalPages()))}else for(var l=1;l<=t.totalPages();l++)a.push(this.createPaginationLink(t,l));if(t.hasMorePages()){var r=t.currentPage()+1;a.push('\n\t\t\t\t\t\t<li class="page-item">\n\t\t\t\t\t\t\t<a class="page-link" data-page="'+r+'" href="javascript:void(0)" rel="next" aria-label="Next">\n\t\t\t\t\t\t\t\t<i class="fas fa-angle-right"></i>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t')}else a.push('\n\t\t\t\t\t\t<li class="page-item disabled" aria-disabled="true" aria-label="Next">\n\t\t\t\t\t\t\t<span class="page-link">\n\t\t\t\t\t\t\t\t<i class="fas fa-angle-right"></i>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t');return a.push("\n\t\t\t</ul>\n\t\t</nav>\n\t\t"),a.join("\n")}},{key:"createPaginationLink",value:function(t,a){return a==t.currentPage()?'\n\t\t\t\t\t<li class="page-item active" aria-current="page"><span class="page-link">'+a+"</span></li>\n\t\t\t":'\n\t\t\t\t\t<li class="page-item" aria-current="page"><a data-page="'+a+'" href="javascript:void(0)" class="page-link">'+a+"</a></li>\n\t\t\t"}},{key:"translateStatus",value:function(t){switch(parseInt(t)){case 1:return"Seen";case 2:return"Started";case 3:return"Finished";default:return"Not Yet Seen"}}},{key:"statusColor",value:function(t){switch(parseInt(t)){case 1:return"warning";case 2:return"primary";case 3:return"success";default:return"danger"}}},{key:"search",value:function(e){var n=this;e=e.trim(),this.data=_.filter(this.originalData,function(t){for(var a=0;a<n.options.searchables.length;a++){if(-1!==t[n.options.searchables[a]].toString().toLowerCase().search(e.toLowerCase()))return!0}}),this.build()}},{key:"filterByMembers",value:function(n){this.data=_.filter(this.originalData,function(t){for(var a=0;a<n.length;a++){var e=n[a];if(_.find(t.members,{id:parseInt(e)}))return!0}}),this.build()}},{key:"newTask",value:function(t){this.originalData.push(t),this.data=this.originalData,this.build()}},{key:"updateTask",value:function(t,a){var e=_.find(this.originalData,{id:t}),n=this.originalData.indexOf(e);if(e){for(var i in a)this.originalData[n][i]=a[i];this.build()}this.data=this.originalData}},{key:"updateTasks",value:function(i,s){this.originalData=_.map(this.originalData,function(t){for(var a=0;a<i.length;a++){var e=i[a];if(t.id==e)for(var n in s)t[n]=s[n]}return t}),this.data=this.originalData,this.build()}},{key:"deleteTask",value:function(t){this.originalData=_.reject(this.originalData,{id:t}),this.data=this.originalData,this.build()}},{key:"deleteTasks",value:function(n){this.originalData=_.reject(this.originalData,function(t){for(var a=0;a<n.length;a++){var e=n[a];if(t.id==e)return!0}return!1}),this.data=this.originalData,this.build()}},{key:"paginateData",value:function(t){var a=_.chunk(t,this.options.perPage);return a[this.options.pageIndex]||(this.options.pageIndex=0),a[this.options.pageIndex]}},{key:"pageCount",value:function(){return Math.ceil(this.data.length/this.options.perPage)}},{key:"goToPage",value:function(t){this.options.pageIndex=t-1,this.options.pageIndex>=this.pageCount()?this.options.pageIndex=0:this.options.pageIndex<0&&(this.options.pageIndex=this.pageCount()-1),this.build()}},{key:"nextPage",value:function(){this.goToPage(this.options.pageIndex+1)}},{key:"prevPage",value:function(){this.goToPage(this.options.pageIndex-1)}},{key:"showAll",value:function(){this.options.perPage=this.data.length,this.build()}},{key:"setEventListeners",value:function(){var n=this;this.container.find("table tr>td:not(.not-selectable,.operations)").on("click",function(t){var a=$(this).closest("tr").find("input[type='checkbox']").first();a.prop("checked",!a.prop("checked")),a.trigger("change")}),this.container.find("table tr>td input[type='checkbox']").on("change",function(t){var a=$(this).data("id");$(this).is(":checked")?n.selectedTasks.push(_.find(n.data,{id:a})):n.selectedTasks=_.reject(n.selectedTasks,{id:a}),n.container.trigger("selected.task-manager",[n.selectedTasks])}),this.container.find("[data-toggle='class']").on("click",function(t){$(this).closest(".task-group").toggleClass("active")}),this.container.on("selected.task-manager",function(t,a){var e=n.container.find(".task-manager-toolbar");0<a.length&&!e.hasClass("active")?e.addClass("active"):0==a.length&&e.hasClass("active")&&e.removeClass("active")}),this.container.find("table tr>td .btn-update-status").on("click",function(t){var a=$(this).data("id"),e=_.find(n.data,{id:a});n.updateTask(a,{status:parseInt(e.status)+1,updated_at:moment().format("YYYY-MM-DD hh:mm:ss")})}),this.container.find("table tr>td.operations .btn-delete").on("click",function(t){t.preventDefault(),n.deleteTask(parseInt($(this).data("id")))}),this.container.find(".task-manager-toolbar .btn-delete-all").on("click",function(t){t.preventDefault(),n.deleteTasks(_.map(n.selectedTasks,function(t){return t.id}))}),this.container.find(".task-manager-toolbar .btn-finish-all").on("click",function(t){t.preventDefault(),n.updateTasks(_.map(n.selectedTasks,function(t){return t.id}),{status:3,updated_at:moment().format("YYYY-MM-DD HH:mm:ss")})}),this.container.find("table tr>td .member-link").on("click",function(t){t.preventDefault();var a=parseInt($(this).data("id"));$("#staff-filter").find('option[value="'+a+'"]').prop("selected",!0),$("#staff-filter").trigger("change")})}},{key:"setUpPaginationEventListeners",value:function(){var a=this;this.paginationContainer.find("[data-page]").on("click",function(t){a.goToPage($(this).data("page"))})}},{key:"removeAllFilters",value:function(){this.data=this.originalData,this.build()}}]),a}();$("#task-manager").on("update.task-manager",function(t){$(".tooltip.show").detach(),$(this).find("table tr>td").find('[data-toggle="tooltip"], .tooltip-top, .tooltip-bottom, .tooltip-left, .tooltip-right').each(function(){var t=$(this),a={};t.data("position")&&(a.position=t.data("position")),t.data("type")&&(a.template='<div class="tooltip tooltip-'+t.data("type")+'" role="tooltip"><div class="arrow"></div><div class="tooltip-inner bg-'+t.data("type")+'"></div></div>'),t.tooltip(a)})}),window.TaskManager=TaskManager;