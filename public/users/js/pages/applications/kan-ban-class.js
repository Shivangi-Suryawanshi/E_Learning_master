"use strict";var _createClass=function(){function a(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}window.elementMatches=function(t,e){var n=Element.prototype;return(n.matches||n.matchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector).call(t,e)};var Kanban=function(){function a(t,e){_classCallCheck(this,a);e=void 0===e?{}:e,this.setOptions(e,{data:null,modal:null,excludes:[]}),this.container=t,this.init(),this.setUpEventListeners();var n=this;return new Promise(function(t,e){setTimeout(function(){t(n)},250)})}return _createClass(a,[{key:"setOptions",value:function(t,e){for(var n in e)void 0===t[n]&&(t[n]=e[n]);this.options=t}},{key:"init",value:function(){var e=this;this.docElem=document.documentElement,this.kanban=this.container[0],this.board=this.container.find(".board")[0],this.itemContainers=this.container.find(".board-column-content"),this.columnGrids=[],this.dragCounter=0,this.boardGrid,this.itemContainers.each(function(){var t=e.initBoard(this);e.columnGrids.push(t)}),this.boardGrid=this.initBoardGrid(this.board)}},{key:"initBoardGrid",value:function(t){return new Muuri(t,{layoutDuration:400,layoutEasing:"ease",dragEnabled:!0,dragSortHeuristics:{sortInterval:0,minDragDistance:0,minBounceBackAngle:0},dragStartPredicate:{handle:".board-column-header"},dragReleaseDuration:400,dragReleaseEasing:"ease"})}},{key:"initBoard",value:function(t){var i=this;return new Muuri(t,{items:".board-item",layoutDuration:400,layoutEasing:"ease",dragEnabled:!0,dragSort:function(){return i.columnGrids},dragSortHeuristics:{sortInterval:0,minDragDistance:0,minBounceBackAngle:0},dragContainer:document.body,dragReleaseDuration:400,dragReleaseEasing:"ease",dragStartPredicate:function(t,e){if(i.options.excludes)for(var n=0;n<i.options.excludes.length;n++){var a=i.options.excludes[n];if($(e.target).is(a)||0<$(e.target).closest(a).length)return!1}return Muuri.ItemDrag.defaultStartPredicate(t,e)}}).on("dragStart",function(t){++i.dragCounter,i.docElem.classList.add("dragging"),t.getElement().style.width=t.getWidth()+"px",t.getElement().style.height=t.getHeight()+"px"}).on("dragEnd",function(t){--i.dragCounter<1&&i.docElem.classList.remove("dragging")}).on("dragReleaseEnd",function(t){t.getElement().style.width="",t.getElement().style.height="",i.columnGrids.forEach(function(t){t.refreshItems()})}).on("layoutStart",function(){i.boardGrid.refreshItems().layout()})}},{key:"setUpEventListeners",value:function(){var i=this;this.modal=this.options.modal,i.container.find(".btn-new").on("click",function(t){var e=$(this).closest(".board-column").attr("id");i.modal.data("target-board",e),i.modal.modal("show")}),i.modal.find("form").on("submit",function(t){t.preventDefault();var e=i.modal.data("target-board"),n=$("#"+e).prevAll(".board-column").length,a=$('\n\t\t\t\t<div class="board-item">\n\t\t\t\t\t<div class="board-item-content">\n\t\t\t\t\t\t<span>'+$(this).find("[name='name']").val()+"</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t")[0];i.columnGrids[n].add(a),i.modal.modal("hide"),$(this).find("[name='name']").val("")}),setTimeout(function(){for(var t=0;t<i.columnGrids.length;t++){i.columnGrids[t].synchronize()}},1e3)}}]),a}();window.Kanban=Kanban;