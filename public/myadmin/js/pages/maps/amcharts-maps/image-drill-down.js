"use strict";$(document).ready(function(){am4core.ready(function(){am4core.useTheme(am4themes_animated);var n=am4core.create("map-9",am4maps.MapChart);n.maxZoomLevel=64,n.geodata=am4geodata_usaLow,n.projection=new am4maps.projections.AlbersUsa;var i=n.tooltipContainer.createChild(am4core.ZoomOutButton);i.align="right",i.valign="top",i.margin(20,20,20,20),i.events.on("hit",function(){c&&c.hide(),n.goHome(),i.hide(),(c=m.US.series).show()}),i.hide();var l=n.series.push(new am4maps.MapPolygonSeries);l.useGeodata=!0,l.calculateVisualCenter=!0;var t=l.mapPolygons.template;t.tooltipText="{name}",t.fill=n.colors.getIndex(0),n.events.on("ready",function(){var t=new am4core.DataSource;t.url="https://s3-us-west-2.amazonaws.com/s.cdpn.io/t-160/TargetStores.json",t.events.on("parseended",function(t){var e;e=t.target.data,m.US={markerData:[],series:function o(t){var e=n.series.push(new am4maps.MapImageSeries);e.dataFields.value=t;var a=e.mapImages.template;a.verticalCenter="middle",a.horizontalCenter="middle",a.propertyFields.latitude="lat",a.propertyFields.longitude="long",a.tooltipText="{name}:\n[bold]{stores} stores[/]";var r=a.createChild(am4core.Circle);r.radius=10,r.fillOpacity=.7,r.verticalCenter="middle",r.horizontalCenter="middle",r.nonScaling=!0;var s=a.createChild(am4core.Label);return s.text="{stores}",s.fill=am4core.color("#fff"),s.verticalCenter="middle",s.horizontalCenter="middle",s.nonScaling=!0,e.heatRules.push({target:r,property:"radius",min:10,max:30}),e.mapImages.template.events.on("hit",function(t){var e=t.target.dataItem.dataContext;if(e.target){if(m[e.target].series||(m[e.target].series=o("count"),m[e.target].series.data=e.markerData),c&&c.hide(),"state"==e.type){var a=l.getPolygonById("US-"+e.state);n.zoomToMapObject(a)}else"city"==e.type&&n.zoomToGeoPoint({latitude:e.lat,longitude:e.long},64,!0);i.show(),(c=m[e.target].series).show()}}),e}("stores")},c=m.US.series,am4core.array.each(e.query_results,function(t){var t={state:t.MAIL_ST_PROV_C,long:am4core.type.toNumber(t.LNGTD_I),lat:am4core.type.toNumber(t.LATTD_I),location:t.co_loc_n,city:t.mail_city_n,count:am4core.type.toNumber(t.count)};if(null==m[t.state]){var e=l.getPolygonById("US-"+t.state);if(!e)return;m[t.state]={target:t.state,type:"state",name:e.dataItem.dataContext.name,count:t.count,stores:1,lat:e.visualLatitude,long:e.visualLongitude,state:t.state,markerData:[]},m.US.markerData.push(m[t.state])}else m[t.state].stores++,m[t.state].count+=t.count;null==m[t.city]?(m[t.city]={target:t.city,type:"city",name:t.city,count:t.count,stores:1,lat:t.lat,long:t.long,state:t.state,markerData:[]},m[t.state].markerData.push(m[t.city])):(m[t.city].stores++,m[t.city].count+=t.count),m[t.city].markerData.push({name:t.location,count:t.count,stores:1,lat:t.lat,long:t.long,state:t.state})}),m.US.series.data=m.US.markerData}),t.load()});var c,m={}})});